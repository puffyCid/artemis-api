"use strict";(self.webpackChunkartemis_docs=self.webpackChunkartemis_docs||[]).push([[5974],{3905:(n,e,t)=>{t.d(e,{Zo:()=>p,kt:()=>m});var a=t(7294);function r(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function i(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,a)}return t}function o(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?i(Object(t),!0).forEach((function(e){r(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function s(n,e){if(null==n)return{};var t,a,r=function(n,e){if(null==n)return{};var t,a,r={},i=Object.keys(n);for(a=0;a<i.length;a++)t=i[a],e.indexOf(t)>=0||(r[t]=n[t]);return r}(n,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(a=0;a<i.length;a++)t=i[a],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(r[t]=n[t])}return r}var l=a.createContext({}),u=function(n){var e=a.useContext(l),t=e;return n&&(t="function"==typeof n?n(e):o(o({},e),n)),t},p=function(n){var e=u(n.components);return a.createElement(l.Provider,{value:e},n.children)},c="mdxType",d={inlineCode:"code",wrapper:function(n){var e=n.children;return a.createElement(a.Fragment,{},e)}},g=a.forwardRef((function(n,e){var t=n.components,r=n.mdxType,i=n.originalType,l=n.parentName,p=s(n,["components","mdxType","originalType","parentName"]),c=u(t),g=r,m=c["".concat(l,".").concat(g)]||c[g]||d[g]||i;return t?a.createElement(m,o(o({ref:e},p),{},{components:t})):a.createElement(m,o({ref:e},p))}));function m(n,e){var t=arguments,r=e&&e.mdxType;if("string"==typeof n||r){var i=t.length,o=new Array(i);o[0]=g;var s={};for(var l in e)hasOwnProperty.call(e,l)&&(s[l]=e[l]);s.originalType=n,s[c]="string"==typeof n?n:r,o[1]=s;for(var u=2;u<i;u++)o[u]=t[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}g.displayName="MDXCreateElement"},6263:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var a=t(7462),r=(t(7294),t(3905));const i={sidebar_position:3,description:"What is bundling"},o="Bundling",s={unversionedId:"Intro/Scripting/bundling",id:"Intro/Scripting/bundling",title:"Bundling",description:"What is bundling",source:"@site/docs/Intro/Scripting/bundling.md",sourceDirName:"Intro/Scripting",slug:"/Intro/Scripting/bundling",permalink:"/artemis-api/docs/Intro/Scripting/bundling",draft:!1,editUrl:"https://github.com/puffyCid/artemis-api/tree/main/artemis-docs/docs/Intro/Scripting/bundling.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,description:"What is bundling"},sidebar:"artemisStart",previous:{title:"TypeScript",permalink:"/artemis-api/docs/Intro/Scripting/typescript"},next:{title:"Filtering",permalink:"/artemis-api/docs/Intro/Scripting/filterscripts"}},l={},u=[{value:"Deno Builtin Bundler",id:"deno-builtin-bundler",level:2},{value:"<code>--no-check</code> Flag",id:"--no-check-flag",level:3},{value:"Output",id:"output",level:3},{value:"Esbuild",id:"esbuild",level:2},{value:"Output",id:"output-1",level:3}],p={toc:u},c="wrapper";function d(n){let{components:e,...t}=n;return(0,r.kt)(c,(0,a.Z)({},p,t,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"bundling"},"Bundling"),(0,r.kt)("p",null,"Currently artemis requires that we have all of our JavaScript code in one .js\nfile. However, while very simple scripts may only be one file, if we decide to\nimport an artemis function, or split our code into multiple files we now have\nmultiple files that need to be combine into one .js file."),(0,r.kt)("p",null,"A Bundler can help us perform this task."),(0,r.kt)("p",null,"The TypeScrpt code below imports a function and the ",(0,r.kt)("inlineCode",{parentName:"p"},"Registry")," interface from\nartemis."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'import { getRegistry } from "https://raw.githubusercontent.com/puffycid/artemis-api/master/mod.ts";\nimport { Registry } from "https://raw.githubusercontent.com/puffycid/artemis-api/master/src/windows/registry.ts";\n\ninterface InstalledPrograms {\n  name: string;\n  version: string;\n  install_location: string;\n  install_source: string;\n  language: string;\n  publisher: string;\n  install_string: string;\n  install_date: string;\n  uninstall_string: string;\n  url_info: string;\n  reg_path: string;\n}\n\nfunction grab_info(reg: Registry[]): InstalledPrograms[] {\n  const programs: InstalledPrograms[] = [];\n  const min_size = 3;\n  for (const entries of reg) {\n    if (entries.values.length < min_size) {\n      continue;\n    }\n    const program: InstalledPrograms = {\n      name: "",\n      version: "",\n      install_location: "",\n      install_source: "",\n      language: "",\n      publisher: "",\n      install_string: "",\n      install_date: "",\n      uninstall_string: "",\n      url_info: "",\n      reg_path: entries.path,\n    };\n\n    for (const value of entries.values) {\n      switch (value.value) {\n        case "DisplayName":\n          program.name = value.data;\n          break;\n        case "DisplayVersion":\n          program.version = value.data;\n          break;\n        case "InstallDate":\n          program.install_date = value.data;\n          break;\n        case "InstallLocation":\n          program.install_location = value.data;\n          break;\n        case "InstallSource":\n          program.install_source = value.data;\n          break;\n        case "Language":\n          program.language = value.data;\n          break;\n        case "Publisher":\n          program.publisher = value.data;\n          break;\n        case "UninstallString":\n          program.uninstall_string = value.data;\n          break;\n        case "URLInfoAbout":\n          program.url_info = value.data;\n          break;\n        default:\n          continue;\n      }\n    }\n    programs.push(program);\n  }\n  return programs;\n}\n\nfunction main() {\n  const path = "C:\\\\Windows\\\\System32\\\\config\\\\SOFTWARE";\n\n  const reg = getRegistry(path);\n  const programs: Registry[] = [];\n  for (const entries of reg) {\n    if (\n      !entries.path.includes(\n        "Microsoft\\\\Windows\\\\CurrentVersion\\\\Uninstall",\n      )\n    ) {\n      continue;\n    }\n    programs.push(entries);\n  }\n  return grab_info(programs);\n}\n\nmain();\n')),(0,r.kt)("p",null,"Lets save this code to the file ",(0,r.kt)("inlineCode",{parentName:"p"},"main.ts"),". Before we can compile the code to\nJavaScript we have to include (bundle) ",(0,r.kt)("inlineCode",{parentName:"p"},"mod.ts")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"registry.ts"),".\\\nThere are multiple types of bundler applications that can help us with this\ntask. Two (2) this book will focus on are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The builtin bundler in Deno"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://deno.land/x/esbuild_deno_loader@0.6.0"},"esbuild Deno loader"))),(0,r.kt)("h2",{id:"deno-builtin-bundler"},"Deno Builtin Bundler"),(0,r.kt)("p",null,"To bundle our ",(0,r.kt)("inlineCode",{parentName:"p"},"main.ts")," and compile to a ",(0,r.kt)("inlineCode",{parentName:"p"},".js")," file. We just need to run:\n",(0,r.kt)("inlineCode",{parentName:"p"},"deno bundle  --no-check main.ts > main.js"),". By default ",(0,r.kt)("inlineCode",{parentName:"p"},"Deno")," wil output to the\nconsole when bundling."),(0,r.kt)("h3",{id:"--no-check-flag"},(0,r.kt)("inlineCode",{parentName:"h3"},"--no-check")," Flag"),(0,r.kt)("p",null,"This flag tells ",(0,r.kt)("inlineCode",{parentName:"p"},"Deno")," not to type check values. This flag is required due to:\n",(0,r.kt)("inlineCode",{parentName:"p"},"Deno.core.ops.get_registry(path)"),"\\\nThe Deno binary is designed to support code written for the Deno platform.\nHowever, we are using a custom Deno runtime.\\\nThe Deno binary has no idea what ",(0,r.kt)("inlineCode",{parentName:"p"},"get_registry")," is because it is a custom\nfunction we have registered in our own runtime."),(0,r.kt)("h3",{id:"output"},"Output"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// deno-fmt-ignore-file\n// deno-lint-ignore-file\n// This code was bundled using `deno bundle` and it\'s not recommended to edit it manually\n\nfunction get_registry(path) {\n    const data = Deno.core.ops.get_registry(path);\n    const reg_array = JSON.parse(data);\n    return reg_array;\n}\nfunction getRegistry(path) {\n    return get_registry(path);\n}\nfunction grab_info(reg) {\n    const programs = [];\n    for (const entries of reg){\n        if (entries.values.length < 3) {\n            continue;\n        }\n        const program = {\n            name: "",\n            version: "",\n            install_location: "",\n            install_source: "",\n            language: "",\n            publisher: "",\n            install_string: "",\n            install_date: "",\n            uninstall_string: "",\n            url_info: "",\n            reg_path: entries.path\n        };\n        for (const value of entries.values){\n            switch(value.value){\n                case "DisplayName":\n                    program.name = value.data;\n                    break;\n                case "DisplayVersion":\n                    program.version = value.data;\n                    break;\n                case "InstallDate":\n                    program.install_date = value.data;\n                    break;\n                case "InstallLocation":\n                    program.install_location = value.data;\n                    break;\n                case "InstallSource":\n                    program.install_source = value.data;\n                    break;\n                case "Language":\n                    program.language = value.data;\n                    break;\n                case "Publisher":\n                    program.publisher = value.data;\n                    break;\n                case "UninstallString":\n                    program.uninstall_string = value.data;\n                    break;\n                case "URLInfoAbout":\n                    program.url_info = value.data;\n                    break;\n                default:\n                    continue;\n            }\n        }\n        programs.push(program);\n    }\n    return programs;\n}\nfunction main() {\n    const path = "C:\\\\Windows\\\\System32\\\\config\\\\SOFTWARE";\n    const reg = getRegistry(path);\n    const programs = [];\n    for (const entries of reg){\n        if (!entries.path.includes("Microsoft\\\\Windows\\\\CurrentVersion\\\\Uninstall")) {\n            continue;\n        }\n        programs.push(entries);\n    }\n    return grab_info(programs);\n}\nmain();\n')),(0,r.kt)("p",null,"The JavaScript code above was generated with the ",(0,r.kt)("inlineCode",{parentName:"p"},"deno bundle")," command and is\nnow ready to be executed by artemis!"),(0,r.kt)("h2",{id:"esbuild"},"Esbuild"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://esbuild.github.io/"},"esbuild")," is a popular Bundler for JavaScript. It is\nnormally run as a standalone binary, however we can import a module that lets us\ndynamically execute esbuild using Deno. In order to do this we need a build\nscript. Using the same ",(0,r.kt)("inlineCode",{parentName:"p"},"main.ts")," file above, create a ",(0,r.kt)("inlineCode",{parentName:"p"},"build.ts")," file in the\nsame directory. Add the following code to ",(0,r.kt)("inlineCode",{parentName:"p"},"build.ts"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'import * as esbuild from "https://deno.land/x/esbuild@v0.15.10/mod.js";\nimport { denoPlugin } from "https://deno.land/x/esbuild_deno_loader@0.6.0/mod.ts";\n\nasync function main() {\n  const _result = await esbuild.build({\n    plugins: [denoPlugin()],\n    entryPoints: ["./main.ts"],\n    outfile: "main.js",\n    bundle: true,\n    format: "cjs",\n  });\n\n  esbuild.stop();\n}\n\nmain();\n')),(0,r.kt)("p",null,"The above script will use the ",(0,r.kt)("inlineCode",{parentName:"p"},"main.ts")," file and bundle all of its pre-requisite\nfiles into one .js file using esbuild. We then execute this code using\n",(0,r.kt)("inlineCode",{parentName:"p"},"deno run build.ts")),(0,r.kt)("h3",{id:"output-1"},"Output"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// https://raw.githubusercontent.com/puffycid/artemis-api/master/src/windows/registry.ts\nfunction get_registry(path) {\n  const data = Deno.core.ops.get_registry(path);\n  const reg_array = JSON.parse(data);\n  return reg_array;\n}\n\n// https://raw.githubusercontent.com/puffycid/artemis-api/master/mod.ts\nfunction getRegistry(path) {\n  return get_registry(path);\n}\n\n// main.ts\nfunction grab_info(reg) {\n  const programs = [];\n  const min_size = 3;\n  for (const entries of reg) {\n    if (entries.values.length < min_size) {\n      continue;\n    }\n    const program = {\n      name: "",\n      version: "",\n      install_location: "",\n      install_source: "",\n      language: "",\n      publisher: "",\n      install_string: "",\n      install_date: "",\n      uninstall_string: "",\n      url_info: "",\n      reg_path: entries.path,\n    };\n    for (const value of entries.values) {\n      switch (value.value) {\n        case "DisplayName":\n          program.name = value.data;\n          break;\n        case "DisplayVersion":\n          program.version = value.data;\n          break;\n        case "InstallDate":\n          program.install_date = value.data;\n          break;\n        case "InstallLocation":\n          program.install_location = value.data;\n          break;\n        case "InstallSource":\n          program.install_source = value.data;\n          break;\n        case "Language":\n          program.language = value.data;\n          break;\n        case "Publisher":\n          program.publisher = value.data;\n          break;\n        case "UninstallString":\n          program.uninstall_string = value.data;\n          break;\n        case "URLInfoAbout":\n          program.url_info = value.data;\n          break;\n        default:\n          continue;\n      }\n    }\n    programs.push(program);\n  }\n  return programs;\n}\nfunction main() {\n  const path = "C:\\\\Windows\\\\System32\\\\config\\\\SOFTWARE";\n  const reg = getRegistry(path);\n  const programs = [];\n  for (const entries of reg) {\n    if (\n      !entries.path.includes(\n        "Microsoft\\\\Windows\\\\CurrentVersion\\\\Uninstall",\n      )\n    ) {\n      continue;\n    }\n    programs.push(entries);\n  }\n  return grab_info(programs);\n}\nmain();\n')),(0,r.kt)("p",null,"The JavaScript code above was generated by esbuild via ",(0,r.kt)("inlineCode",{parentName:"p"},"Deno")," and is now ready\nto be executed by artemis!"))}d.isMDXComponent=!0}}]);