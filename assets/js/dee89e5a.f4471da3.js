"use strict";(self.webpackChunkartemis_docs=self.webpackChunkartemis_docs||[]).push([[4321],{28453:(n,e,r)=>{r.d(e,{R:()=>i,x:()=>o});var a=r(96540);const t={},s=a.createContext(t);function i(n){const e=a.useContext(s);return a.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:i(n.components),a.createElement(s.Provider,{value:e},n.children)}},45546:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"Intro/Scripting/bundling","title":"Bundling","description":"What is bundling","source":"@site/docs/Intro/Scripting/bundling.md","sourceDirName":"Intro/Scripting","slug":"/Intro/Scripting/bundling","permalink":"/artemis-api/docs/Intro/Scripting/bundling","draft":false,"unlisted":false,"editUrl":"https://github.com/puffyCid/artemis-api/tree/main/artemis-docs/docs/Intro/Scripting/bundling.md","tags":[],"version":"current","lastUpdatedBy":"puffyCid","lastUpdatedAt":1753221820000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3,"description":"What is bundling"},"sidebar":"artemisStart","previous":{"title":"TypeScript","permalink":"/artemis-api/docs/Intro/Scripting/typescript"},"next":{"title":"Filtering","permalink":"/artemis-api/docs/Intro/Scripting/filterscripts"}}');var t=r(74848),s=r(28453);const i={sidebar_position:3,description:"What is bundling"},o="Bundling",l={},c=[{value:"Esbuild",id:"esbuild",level:2},{value:"Output",id:"output",level:3}];function u(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"bundling",children:"Bundling"})}),"\n",(0,t.jsx)(e.p,{children:"Currently artemis requires that we have all of our JavaScript code in one .js\nfile. However, while very simple scripts may only be one file, if we decide to\nimport an artemis function or split our code into multiple files we now have\nmultiple files that need to be combine into one .js file."}),"\n",(0,t.jsx)(e.p,{children:"A Bundler can help us perform this task."}),"\n",(0,t.jsx)(e.p,{children:"The TypeScript code below imports a function and the Registry interface from\nartemis."}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:'import { getRegistry } from "./artemis-api/mod";\nimport { WindowsError } from "./artemis-api/src/windows/errors";\nimport { Registry } from "./artemis-api/types/windows/registry";\n\ninterface InstalledPrograms {\n  name: string;\n  version: string;\n  install_location: string;\n  install_source: string;\n  language: string;\n  publisher: string;\n  install_string: string;\n  install_date: string;\n  uninstall_string: string;\n  url_info: string;\n  reg_path: string;\n}\n\nfunction grab_info(reg: Registry[]): InstalledPrograms[] {\n  const programs: InstalledPrograms[] = [];\n  const min_size = 3;\n  for (const entries of reg) {\n    if (entries.values.length < min_size) {\n      continue;\n    }\n    const program: InstalledPrograms = {\n      name: "",\n      version: "",\n      install_location: "",\n      install_source: "",\n      language: "",\n      publisher: "",\n      install_string: "",\n      install_date: "",\n      uninstall_string: "",\n      url_info: "",\n      reg_path: entries.path,\n    };\n\n    for (const value of entries.values) {\n      switch (value.value) {\n        case "DisplayName":\n          program.name = value.data;\n          break;\n        case "DisplayVersion":\n          program.version = value.data;\n          break;\n        case "InstallDate":\n          program.install_date = value.data;\n          break;\n        case "InstallLocation":\n          program.install_location = value.data;\n          break;\n        case "InstallSource":\n          program.install_source = value.data;\n          break;\n        case "Language":\n          program.language = value.data;\n          break;\n        case "Publisher":\n          program.publisher = value.data;\n          break;\n        case "UninstallString":\n          program.uninstall_string = value.data;\n          break;\n        case "URLInfoAbout":\n          program.url_info = value.data;\n          break;\n        default:\n          continue;\n      }\n    }\n    programs.push(program);\n  }\n  return programs;\n}\n\nfunction main() {\n  const path = "C:\\\\Windows\\\\System32\\\\config\\\\SOFTWARE";\n\n  const reg = getRegistry(path);\n  if (reg instanceof WindowsError) {\n    console.error(reg);\n    return;\n  }\n  const programs: Registry[] = [];\n  for (const entries of reg) {\n    if (\n      !entries.path.includes(\n        "Microsoft\\\\Windows\\\\CurrentVersion\\\\Uninstall",\n      )\n    ) {\n      continue;\n    }\n    programs.push(entries);\n  }\n  return grab_info(programs);\n}\n\nmain();\n\n'})}),"\n",(0,t.jsxs)(e.p,{children:["Lets save this code to the file main.ts. Before we can compile the code to\nJavaScript we have to include (bundle) ",(0,t.jsx)(e.code,{children:"mod.ts"})," and ",(0,t.jsx)(e.code,{children:"registry.ts"}),"."]}),"\n",(0,t.jsxs)(e.p,{children:["There are multiple types of bundler applications that can help us with this\ntask. One of the most popular ones is ",(0,t.jsx)(e.a,{href:"https://esbuild.github.io/",children:"esbuild"})]}),"\n",(0,t.jsx)(e.h2,{id:"esbuild",children:"Esbuild"}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.a,{href:"https://esbuild.github.io/",children:"esbuild"})," is a popular Bundler for JavaScript. It can be run as a standalone binary.\nOnce you have esbuild installed you can transpile and bundle your TypeScript with the following command:"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"esbuild --bundle --outfile=out.js main.ts\n"})}),"\n",(0,t.jsxs)(e.admonition,{type:"info",children:[(0,t.jsx)(e.p,{children:"esbuild can also minify JavaScript code! This can dramatically reduce the size of your script"}),(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"esbuild --bundle --minify --outfile=out.js main.ts\n"})})]}),"\n",(0,t.jsx)(e.p,{children:"The above commands will use the main.ts file and bundle all of its pre-requisite\nfiles into one .js file using esbuild."}),"\n",(0,t.jsx)(e.h3,{id:"output",children:"Output"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:'(() => {\n  // ./artemis-api/src/utils/error.ts\n  var ErrorBase = class extends Error {\n    name;\n    message;\n    constructor(name, message) {\n      super();\n      this.name = name;\n      this.message = message;\n    }\n  };\n\n  // ./artemis-api/src/windows/errors.ts\n  var WindowsError = class extends ErrorBase {\n  };\n\n  // ./artemis-api/src/windows/registry.ts\n  function getRegistry(path) {\n    try {\n      const data = js_registry(path);\n      return data;\n    } catch (err) {\n      return new WindowsError(\n        "REGISTRY",\n        `failed to parse registry file ${path}: ${err}`\n      );\n    }\n  }\n\n  // main.ts\n  function grab_info(reg) {\n    const programs = [];\n    const min_size = 3;\n    for (const entries of reg) {\n      if (entries.values.length < min_size) {\n        continue;\n      }\n      const program = {\n        name: "",\n        version: "",\n        install_location: "",\n        install_source: "",\n        language: "",\n        publisher: "",\n        install_string: "",\n        install_date: "",\n        uninstall_string: "",\n        url_info: "",\n        reg_path: entries.path\n      };\n      for (const value of entries.values) {\n        switch (value.value) {\n          case "DisplayName":\n            program.name = value.data;\n            break;\n          case "DisplayVersion":\n            program.version = value.data;\n            break;\n          case "InstallDate":\n            program.install_date = value.data;\n            break;\n          case "InstallLocation":\n            program.install_location = value.data;\n            break;\n          case "InstallSource":\n            program.install_source = value.data;\n            break;\n          case "Language":\n            program.language = value.data;\n            break;\n          case "Publisher":\n            program.publisher = value.data;\n            break;\n          case "UninstallString":\n            program.uninstall_string = value.data;\n            break;\n          case "URLInfoAbout":\n            program.url_info = value.data;\n            break;\n          default:\n            continue;\n        }\n      }\n      programs.push(program);\n    }\n    return programs;\n  }\n  function main() {\n    const path = "C:\\\\Windows\\\\System32\\\\config\\\\SOFTWARE";\n    const reg = getRegistry(path);\n    if (reg instanceof WindowsError) {\n      console.error(reg);\n      return;\n    }\n    const programs = [];\n    for (const entries of reg) {\n      if (!entries.path.includes(\n        "Microsoft\\\\Windows\\\\CurrentVersion\\\\Uninstall"\n      )) {\n        continue;\n      }\n      programs.push(entries);\n    }\n    return grab_info(programs);\n  }\n  main();\n})();\n'})}),"\n",(0,t.jsx)(e.p,{children:"The JavaScript code above was generated by esbuild and is now ready to\nbe executed by artemis!"}),"\n",(0,t.jsx)(e.p,{children:"If you choose to minify the JavaScript you would get something like this:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-javascript",children:'(()=>{var c=class extends Error{name;message;constructor(_,M){super(),this.name=_,this.message=M}};var e=class extends c{};function U(I){try{return js_registry(I)}catch(_){return new e("REGISTRY",`failed to parse registry file ${I}: ${_}`)}}function ge(I){let _=[];for(let T of I){if(T.values.length<3)continue;let E={name:"",version:"",install_location:"",install_source:"",language:"",publisher:"",install_string:"",install_date:"",uninstall_string:"",url_info:"",reg_path:T.path};for(let w of T.values)switch(w.value){case"DisplayName":E.name=w.data;break;case"DisplayVersion":E.version=w.data;break;case"InstallDate":E.install_date=w.data;break;case"InstallLocation":E.install_location=w.data;break;case"InstallSource":E.install_source=w.data;break;case"Language":E.language=w.data;break;case"Publisher":E.publisher=w.data;break;case"UninstallString":E.uninstall_string=w.data;break;case"URLInfoAbout":E.url_info=w.data;break;default:continue}_.push(E)}return _}function _e(){let _=U("C:\\\\Windows\\\\System32\\\\config\\\\SOFTWARE");if(_ instanceof e){console.error(_);return}let M=[];for(let T of _)T.path.includes("Microsoft\\\\Windows\\\\CurrentVersion\\\\Uninstall")&&M.push(T);return ge(M)}_e();})();\n\n'})})]})}function d(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(u,{...n})}):u(n)}}}]);