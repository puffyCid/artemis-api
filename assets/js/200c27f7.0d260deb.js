"use strict";(globalThis.webpackChunkartemis_docs=globalThis.webpackChunkartemis_docs||[]).push([[7510],{40943(e,t,n){n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"Artifacts/Windows Artfacts/certificates","title":"Active Directory Certs","description":"Windows Active Directory Certificates","source":"@site/docs/Artifacts/Windows Artfacts/certificates.md","sourceDirName":"Artifacts/Windows Artfacts","slug":"/Artifacts/Windows Artfacts/certificates","permalink":"/artemis-api/docs/Artifacts/Windows Artfacts/certificates","draft":false,"unlisted":false,"editUrl":"https://github.com/puffyCid/artemis-api/tree/main/artemis-docs/docs/Artifacts/Windows Artfacts/certificates.md","tags":[],"version":"current","lastUpdatedBy":"puffyCid","lastUpdatedAt":1770498354000,"frontMatter":{"description":"Windows Active Directory Certificates","keywords":["windows","ese"]},"sidebar":"artemisArtifacts","previous":{"title":"BITS","permalink":"/artemis-api/docs/Artifacts/Windows Artfacts/bits"},"next":{"title":"Chocolatey","permalink":"/artemis-api/docs/Artifacts/Windows Artfacts/chocolatey"}}');var s=n(74848),r=n(28453);const a={description:"Windows Active Directory Certificates",keywords:["windows","ese"]},c="Active Directory Certs",o={},d=[{value:"References",id:"references",level:2},{value:"Collection",id:"collection",level:2},{value:"Sample API Script",id:"sample-api-script",level:2},{value:"Output Structure",id:"output-structure",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"active-directory-certs",children:"Active Directory Certs"})}),"\n",(0,s.jsx)(t.p,{children:"Artemis supports parsing AD certificates from ESE databases on Windows servers. Parsing this data may be useful to identify vulnerable certificates on a system."}),"\n",(0,s.jsx)(t.h2,{id:"references",children:"References"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://www.crowdstrike.com/wp-content/uploads/2023/12/investigating-active-directory-certificate-abuse.pdf",children:"CrowdStrike White Paper"})}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"collection",children:"Collection"}),"\n",(0,s.jsxs)(t.p,{children:["You have to use the artemis ",(0,s.jsx)(t.a,{href:"/artemis-api/docs/API/overview",children:"api"})," in order to collect parse AD certificates."]}),"\n",(0,s.jsx)(t.h2,{id:"sample-api-script",children:"Sample API Script"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-typescript",children:'import { ADCertificates } from "./artemis-api/mod";\nimport { WindowsError } from "./artemis-api/src/windows/errors";\n\nfunction main() {\n    // You may also provide an optional alternative path to the ESE database\n    const client = new ADCertificates();\n    const catalog = client.catalogInfo();\n    if (catalog instanceof WindowsError) {\n        return;\n    }\n    const first_page = client.tableInfo(catalog, "Certificates").table_page;\n    const cert_pages = client.getPages(first_page);\n    if (cert_pages instanceof WindowsError) {\n        return;\n    }\n    // Depending on size of EDB file you should customize the number of pages you use\n    // The larger the pages array the more memory required\n    const certs = client.getCertificates(cert_pages, client.tableInfo(catalog, "Certificates"))\n    console.log(JSON.stringify(certs));\n}\n\nmain();\n'})}),"\n",(0,s.jsx)(t.h2,{id:"output-structure",children:"Output Structure"}),"\n",(0,s.jsx)(t.p,{children:"Depends on functions called from the ADCertificates class."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-typescript",children:'export interface Certificates {\n    common_name: string;\n    request_id: number;\n    /** Base64 encoded */\n    raw_cert: string;\n    hash: string;\n    serial_number: string;\n    distinguished_name: string;\n    domain: string;\n}\n\nexport interface Requests {\n    request_id: number;\n    request_type: RequestType;\n    status_code_number: number;\n    status_code: StatusCode;\n    disposition_message: string;\n    requester_name: string;\n    caller_name: string;\n    request_attributes: string;\n    submitted: string;\n    resolved: string;\n}\n\nexport interface RequestAttributes {\n    request_id: number;\n    name: string;\n    value: string;\n}\n\nexport enum RequestType {\n    PKCS10_Full = "PKCS10, Full Response",\n    PKCS10 = "PKCS10",\n    Unknown = "Unknown",\n}\n\n/**\n * Various status codes for certificate requests\n * There are [alot](https://github.com/fox-it/dissect.database/pull/7/files#diff-60ccdb935072fd3aa71d6810f7c3aa7ca8ef42aadc6ce9e39ed5f54c5cc36d31R28)\n * Only some listed so far\n */\nexport enum StatusCode {\n    Completed = "Operation Completed Successfully",\n    BadRequestSubject = "Bad Request Subject",\n    NoRequest = "No Request",\n    Empty = "Property Empty",\n    InvalidCA = "Invalid CA Certificte",\n    Suspended = "Server Suspended",\n    EncodingLength = "Encoding Length",\n    Conflict = "Role Conflict",\n    Restrict = "Restricted Officer",\n    NotConfigured = "Key Archival Not Configured",\n    Kra = "No Valid KRA",\n    BadRequest = "Bad Request Key Archival",\n    NoAdmin = "No CA Admin Defined",\n    BadRenewal = "Bad Renewal Cert Attribute",\n    NoSessions = "No DB Sessions",\n    Fault = "Alignment Fault",\n    Denied = "Enroll Denied",\n    TemplateDenied = "Template Denied",\n    Downlevel = "Downlevel DC SSL or Upgrade",\n    NoPolicy = "No Policy Server",\n    Unknown = "Unknown",\n}\n'})})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453(e,t,n){n.d(t,{R:()=>a,x:()=>c});var i=n(96540);const s={},r=i.createContext(s);function a(e){const t=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:t},e.children)}}}]);